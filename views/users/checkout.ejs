<% let count = 0 %>

<%- include('../layouts/header.ejs') %>

<div class="page-wrapper">
	
	<%- include('../layouts/navbar-2.ejs') %>

     <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title text-black-50  ">Checkout<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Cart</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

				<!-- Modal For Address Add-->

                                        <div class="modal fade" id="addss" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">   <!-- Add Addres Modal -->

                                          <div class="modal-dialog">
                                            <div class="modal-content">

                                              <div class="modal-header">
                                                <h6 class="modal-title " id="exampleModalLabel">Add Address</h6>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                              </div>
<!-- 
                                              <div class="modal-body">

                                                <form method="post" style="padding-left: 15px;padding-right: 15px;" id="addform">

											      <p id="msg" hidden ><%= msgg %></p>
                                                  
                                                  <div class="row">

                                                  <div class="col-lg-6">
                                                      <label for="name" class="col-form-label text-black">Name *</label>
                                                      <input type="text" class="form-control" name="name" id="name" placeholder="Enter your Name" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="phone" class="col-form-label text-black">Mobile Number *</label>
                                                      <input type="text" class="form-control" name="phone" id="phone" placeholder="Enter your Mobile" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="locality" class="col-form-label text-black">Loacality *</label>
                                                      <input type="text" class="form-control" name="locality" id="locality" placeholder="Enter your Locality" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="pincode" class="col-form-label text-black">Pincode *</label>
                                                      <input type="text" class="form-control" name="pincode" id="pincode" placeholder="Enter your pincode" required>
                                                  </div>

                                                  </div>

                                                  <div class="col-lg-12">

                                                    <label for="display-name" class="requird text-dark"  >Address *</label>
                                                    <textarea type="text"  id="" class="form-control " rows="3" placeholder="Enter your Address" name="address" required></textarea>

                                                  </div>

                                                  <div class="row mb-1">

                                                     <div class="col-lg-6">
                                                      <label for="city" class="col-form-label text-black">City *</label>
                                                      <input type="text" class="form-control" name="city" id="city" placeholder="Enter your City" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="state" class="col-form-label text-black">State *</label>
                                                      <input type="text" class="form-control" name="state" id="state" placeholder="Enter your State" required>
                                                  </div>

                                                  </div>
                                                  
                                              </form>
                                              
                                              </div> -->
											  <div class="modal-body">
												<form  style="padding-left: 15px;padding-right: 15px;" id="addform" >
											  
												  <p id="msg" hidden><%= msgg %></p>
											  
												  <div class="row">
													<div class="col-lg-6">
													  <label for="name" class="col-form-label text-black">Name *</label>
													  <input type="text" class="form-control" name="name" id="name" placeholder="Enter your Name" required>
													</div>
											  
													<div class="col-lg-6">
													  <label for="phone" class="col-form-label text-black">Mobile Number *</label>
													  <input type="text" class="form-control" name="phone" id="phone" placeholder="Enter your Mobile" required>
													  <div id="phoneError" class="text-danger"></div>
													</div>
											  
													<div class="col-lg-6">
													  <label for="locality" class="col-form-label text-black">Locality *</label>
													  <input type="text" class="form-control" name="locality" id="locality" placeholder="Enter your Locality" required>
													</div>
											  
													<div class="col-lg-6">
													  <label for="pincode" class="col-form-label text-black">Pincode *</label>
													  <input type="text" class="form-control" name="pincode" id="pincode" placeholder="Enter your pincode" required>
													  <div id="pincodeError" class="text-danger"></div>
													</div>
												  </div>
											  
												  <div class="col-lg-12">
													<label for="display-name" class="requird text-dark">Address *</label>
													<textarea type="text" id="" class="form-control" rows="3" placeholder="Enter your Address" name="address" required></textarea>
												  </div>
											  
												  <div class="row mb-1">
													<div class="col-lg-6">
													  <label for="city" class="col-form-label text-black">City *</label>
													  <input type="text" class="form-control" name="city" id="city" placeholder="Enter your City" required>
													  <div id="cityError" class="text-danger"></div>
													</div>
											  
													<div class="col-lg-6">
													  <label for="state" class="col-form-label text-black">State *</label>
													  <input type="text" class="form-control" name="state" id="state" placeholder="Enter your State" required>
													  <div id="stateError" class="text-danger"></div>
													</div>
												  </div>
											  
												  <div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
													<!-- <button type="submit" class="btn btn-primary" data-bs-dismiss="modal" onclick="addAddress('<%= userData._id %>')" >Add</button> -->
													<button type="submit" class="btn btn-primary" data-bs-dismiss="modal" onclick="if(validateForm()) { addAddress('<%= userData._id %>'); }">Add</button>
												  </div>
												</form>
											  </div>

                                              <!-- <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary" data-bs-dismiss="modal" onclick="addAddress('<%= userData._id %>')" >Add</button>
                                              </div> -->

                                            </div>
                                          </div>

                                	</div>

						<!--- End Add Address -->

			
			<!-- Button trigger modal -->
			
			<!-- Button trigger modal -->

		<!--Modal Choose Address-->

		<div class="modal fade" id="change" tabindex="-1" aria-labelledby="ex" aria-hidden="true">

			<div class="modal-dialog">

				<div class="modal-content">

					<div class="modal-header">
						<h5 class="modal-title" id="ex">Choose Address</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>

					<div class="modal-body">

						<div class="row">

							<% for (let i = 0; i < addres?.addresss?.length; i++) { %>
								<% if (!addres?.addresss[i]?.status) { %>
									<div class="col-lg-5" style="margin: auto;">
										<div class="card card-dashboard mt-2 style" style="width: 100;box-shadow:1px 1px 4px 0px#888888;" onclick="addresChoose('<%= addres.addresss[i]._id %>')">
											<div class="card-body" style="cursor: pointer;">
												<h3 class="card-title">Address</h3>
												<p><span style="font-size: 1vw;"><%= addres.addresss[i].name %></span></p>
												<p>
													<span><%= addres.addresss[i].address %></span>,
													<br>
													<span><%= addres.addresss[i].locality %>,</span>
													<span><%= addres.addresss[i].city %>,</span>
													<span><%= addres.addresss[i].state %>,</span>
													<span><%= addres.addresss[i].pincode %> </span>
													<br>
													<span>Phone: <%= addres.addresss[i].phone %> </span>
												</p>
											</div>
										</div>
									</div>
								<% } else if (addres.addresss.length <= 1) { %>
									<div class="p-3">
										<p class="text-center">Add Another Address To Change <a href="/address">Click Here</a></p>
									</div>
								<% } %>
							<% } %>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		
            <div class="page-content">
            	<div class="checkout">
	                <div class="container">
            			<div class="cart-discount">
										
							<form action="/useCoupen" method="post">

								<p id="msg" hidden><%= msgg %></p>
								
							<% if (cartData.percentage == 0) { %>

								<div class="input-group">

									<input type="text" class="form-control" name="coupen" required oninput="coupenCheck(this)" placeholder="coupon code">

									<div class="input-group-append">
										<button class="btn btn-outline-primary-2 mb-3 " id="btn" type="submit"><i class="icon-long-arrow-right"></i></button>
									</div><!-- .End .input-group-append -->

								</div><!-- End .input-group -->
									
							<%	} else { %>

								<div class="input-group">

									<input type="text" class="form-control" name="coupen" required placeholder="coupon code" disabled >

									<div class="input-group-append">
										<button class="btn btn-outline-primary-2" id="btn" onclick="remove()" type="submit">Remove</button>
									</div><!-- .End .input-group-append -->

								</div><!-- End .input-group -->

							<% } %>

								<span class="" id="g"></span>
							</form>
						</div><!-- End .cart-discount -->

						<% if (!locals.addres || locals.addres.addresss.length == 0) { %>

						  		<!-- Modal For Address Add-->

								<!--- End Add Address -->
							
		                	<div class="row"> 

		                		<div class="col-lg-9">

		                			<!-- <h2 class="checkout-title">Billing Details</h2>End .checkout-title -->

									<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addss">
										Add Address
									</button>
									
									<div class="text-center text-info" style="margin-top: 20rem;"><p>Click The Add Address Button to Add Address</p></div><!--Message-->

		                				<div class="row">

		                					<div class="col-sm-6">

		                						<!-- <label>Name *</label>
		                						<input type="text" class="form-control" name="name" required> -->

		                					</div><!---End .col-sm-6-->

		                					<div class="col-sm-6">
												
		                						<!-- <label>Mobile Number *</label>
		                						<input type="text" class="form-control" name="phone" required> -->

		                					</div><!--End .col-sm-6 -->

		                				</div><!---End .row -->
 
	            						<!-- <label>Company Name (Optional)</label>
	            						<input type="text" class="form-control">

	            						<label>Country *</label>
	            						<input type="text" class="form-control" required>

	            						<label>Street address *</label>
	            						<input type="text" class="form-control" placeholder="House number and Street name" required>
	            						<input type="text" class="form-control" placeholder="Appartments, suite, unit etc ..." required>  -->

	            						<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>Locality *</label>
		                						<input type="text" class="form-control" name="locality" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>City *</label>
		                						<input type="text" class="form-control" name="city" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

		                				<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>State *</label>
		                						<input type="text" class="form-control" name="state" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>Pincode *</label>
		                						<input type="tel" class="form-control" name="pincode" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

	                					<!-- <label>Email address *</label>
	        							<input type="email" class="form-control" required> 

	        							 <div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-create-acc">
											<label class="custom-control-label" for="checkout-create-acc">Create an account?</label>
										</div>End .custom-checkbox

										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-diff-address">
											<label class="custom-control-label" for="checkout-diff-address">Ship to a different address?</label>
										</div>End .custom-checkbox -->

	                					<!-- <label>Address</label> -->

	        							<!-- <textarea class="form-control" cols="30" rows="4" name="address" placeholder="enter your address"></textarea> -->

									</div><!--End .col-lg-9-->

					<% } else { %>
		
						<div class="row"> 

            			<!-- <form action="#"> -->

		                		<div class="col-lg-9">

                                    <div class="row">
										
								     <% for (let i = 0; i < addres.addresss.length; i++) { %>

										<% if (addres.addresss[i].status == true ) { %>
                                                                                                                                                                                                                                                                               
                                         <div class="col-lg-5">

                                            <div class="card card-dashboard mt-1">
												
                                                <div class="card-body" style="padding: 20px; cursor: pointer;">

											  <!-- <input type="checkbox" class="card-checkbox mb-2 "> -->

													<!-- <button type="button" class="close" aria-label="Close"  style="font-size: 23px;padding-bottom: 20px;" onclick="deleteAdd('<%= userData._id %>' , '<%= addres.addresss[i]._id %>')">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button> -->

													<span style="cursor: pointer; display: flex; justify-content: end;" data-bs-toggle="modal" data-bs-target="#change">Change</span>

                                                    <h3 class="card-title">Address</h3><!-- End .card-title -->

                                                   <span s><%= addres.addresss[i].name %></span>
													<p><span><%= addres.addresss[i].address %></span>,
														<br><span><%= addres.addresss[i].locality %>,</span>
														<span><%= addres.addresss[i].city %>,</span>
														<span><%= addres.addresss[i].state %>,</span>
														<span><%= addres.addresss[i].pincode %> </span>
														<br>
														<span>Phone: <%= addres.addresss[i].phone %> </span>
													</p>

												    <a herf="#" style="cursor: pointer; color: rgb(207, 149, 77);" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editAddress('<%= addres.addresss[i]._id %>')">Edit<i class="icon-edit"></i></a>

                                                 </div><!-- End .card-body -->

                                            </div><!-- End .card-dashboard -->

                                        	</div><!-- End .col-lg-6 -->

									    <% } else if (locals.addres.addresss.length == 1 || locals.addres.addresss[0].status == false) { %>

											<% count++ %>

												<% if (count == addres.addresss.length) { %>

														<div class="row"> 

															<div class="col-lg-9">

														<!-- <h2 class="checkout-title">Billing Details</h2>End .checkout-title -->
		
															<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addss">
																Add Address
															</button>
															
															<div class="text-center text-info" style="margin-top: 20rem;"><p>Click The Add Address Button to Add Address</p></div><!--Message-->
															</div>

														</div>


											    <%	} %>

												
										<% } %>

											<!--Edit Address Modal-->

											  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                                  <div class="modal-dialog">

                                                    <div class="modal-content">

                                                      <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Address</h1>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                      </div>

                                                      <div class="modal-body" style="padding: 13px;">

                                                        <form action="verifyEditAddCheckout" method="post" style="padding-left: 15px;padding-right: 15px;" id="">

												         <p class="" hidden id="msg"><%= msgg %></p>

                                                        <div class="row">

                                                        <div class="col-lg-6">
                                                            <label for="name" class="col-form-label text-black">Name *</label>
                                                            <input type="text" class="form-control" name="name" id="n" placeholder="Enter your Name" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="phone" class="col-form-label text-black">Mobile Number *</label>
                                                            <input type="text" class="form-control" name="phone" id="pii" placeholder="Enter your Mobile" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="locality" class="col-form-label text-black">Loacality *</label>
                                                            <input type="text" class="form-control" name="locality" id="loca" placeholder="Enter your Locality" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="pincode" class="col-form-label text-black">Pincode *</label>
                                                            <input type="text" class="form-control" name="pincode" id="p" placeholder="Enter your pincode" required>
                                                        </div>

                                                        </div>

                                                        <div class="col-lg-12">

                                                          <label for="display-name" class=" requird text-dark"  >Address *</label>
                                                          <textarea type="text" style="color: gray;"  id="a" class="form-control" rows="3" placeholder="Enter your Address" name="address" required></textarea>

                                                        </div>

                                                        <div class="row mb-1">

                                                          <div class="col-lg-6">
                                                            <label for="city" class="col-form-label text-black">City *</label>
                                                            <input type="text" class="form-control" name="city" id="c" placeholder="Enter your City" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="state" class="col-form-label text-black">State *</label>
                                                            <input type="text" class="form-control" name="state" id="s" placeholder="Enter your State" required>
                                                        </div>

                                                        </div>

                                                        <input type="hidden" name="id" id="i">
														
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
															<button type="submit" class="btn btn-primary">Save changes</button>
														</div>
																										
                                                    </form>
                                                                                                    
                                                      </div>

                                                    </div>

                                                  </div>

                                                </div>
									
									<%  } %>

                                    </div><!-- End .row -->

		                			<!-- <h2 class="checkout-title">Billing Details</h2>End .checkout-title -->

		                				<div class="row">

		                					<div class="col-sm-6">

		                						<!-- <label>Name *</label>
		                						<input type="text" class="form-control" name="name" required> -->

		                					</div><!---End .col-sm-6-->

		                					<div class="col-sm-6">
												
		                						<!-- <label>Mobile Number *</label>
		                						<input type="text" class="form-control" name="phone" required> -->

		                					</div><!--End .col-sm-6 -->

		                				</div><!---End .row -->
 
	            						<!-- <label>Company Name (Optional)</label>
	            						<input type="text" class="form-control">

	            						<label>Country *</label>
	            						<input type="text" class="form-control" required>

	            						<label>Street address *</label>
	            						<input type="text" class="form-control" placeholder="House number and Street name" required>
	            						<input type="text" class="form-control" placeholder="Appartments, suite, unit etc ..." required>  -->

	            						<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>Locality *</label>
		                						<input type="text" class="form-control" name="locality" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>City *</label>
		                						<input type="text" class="form-control" name="city" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

		                				<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>State *</label>
		                						<input type="text" class="form-control" name="state" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>Pincode *</label>
		                						<input type="tel" class="form-control" name="pincode" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

	                					<!-- <label>Email address *</label>
	        							<input type="email" class="form-control" required> 

	        							 <div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-create-acc">
											<label class="custom-control-label" for="checkout-create-acc">Create an account?</label>
										</div>End .custom-checkbox

										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-diff-address">
											<label class="custom-control-label" for="checkout-diff-address">Ship to a different address?</label>
										</div>End .custom-checkbox -->

	                					<!-- <label>Address</label> -->

	        							<!-- <textarea class="form-control" cols="30" rows="4" name="address" placeholder="enter your address"></textarea> -->

									</div><!--End .col-lg-9-->

					<% } %>

					<!-- <form > -->

						<aside class="col-lg-3">
							
						<form action="/getOrder" method="post" id="myForm">

		                			<div class="summary">
		                				<h3 class="summary-title">Your Order</h3><!-- End .summary-title -->

		                				<table class="table table-summary">
		                					<thead>
		                						<tr>
		                							<th>Product</th>
		                							<th>Total</th>
		                						</tr>
		                					</thead>

											<tbody>
                                                    <% cartData?.product?.forEach((product, index)=> { %>

                                                        <tr>

                                                            <td><a href="#">
                                                                <%=product?.productId.name %>
                                                                </a></td>
                                                            <td>$<%=product.price%>.00</td>
                                                        </tr>

                                                    <% }) %>

                                                            <tr class="summary-subtotal">
                                                                <td>Subtotal:</td>
                                                                <td>$<%= cartData?.Total_price %>.00</td>
                                                            </tr><!-- End .summary-subtotal -->

                                                            <tr>
                                                                <td>Shipping:</td>
                                                                <td>Free shipping</td>
                                                            </tr>

                                                            <tr class="summary-total">
                                                                <td>Total:</td>
                                                                <td>$<%= cartData?.Total_price %>.00</td>
                                                            </tr><!-- End .summary-total -->
															
                                                </tbody>
		                				
		                				</table><!-- End .table table-summary -->

											<div class="accordion-summary" id="accordion-payment">

												<div class="card">

												<% if (cartData?.Total_price < 1000) { %>
													
													<div class="card-header" id="heading-1">
		
														<h2 class="card-title">
		
															<input type="radio" name="payment" value="COD" class="bg-primary">
		
															<label for="">Cash on Delivery</label>
		
														</h2>
		
													</div>

											<%	} else { %>

												<div class="card-header" id="heading-1">

													<h2 class="card-title">

														<input disabled type="radio" name="payment" value="COD" class="bg-primary">

														<label style="text-decoration: line-through;" for="">Cash on Delivery</label>

													</h2>

												</div>
													
											<%	} %>



													<div class="card-header mt-1" id="heading-1">

														<h2 class="card-title">

															<input type="radio" name="payment" value="Online" class="bg-primary" checked>

															<label for="">Online Payment</label>

														</h2>

													</div>
												
													<!-- <input type="text" name="" id="" onclick="submit()" hidden > -->
													<!-- End .card-header -->
					

												</div><!-- End .card -->
													
												</div><!-- End .accordion -->

											<div>

												<button type="button" class="btn btn-outline-primary-2 btn-order btn-block" onclick="sumbitPayment('<%= cartData.Total_price %>' , '<%= cartData._id %>')">

													<span class="btn-text">Place Order</span>
													<span class="btn-hover-text">Proceed to Checkout</span>

												</button>

											</div>
										
		                			</div><!-- End .summary -->

								</form>

		                	</aside><!-- End .col-lg-3 -->

						<!-- </form> -->

	                </div><!-- End .container -->
                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->

	<!-- Connect Footer -->
		<%- include('../layouts/footbar-2') %>
		<!-- Connect Footer -->
     
	</div><!-- End .page-wrapper -->

    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

		<!--Connect Mobaile View-->
        <%- include('../layouts/mobileView.ejs') %>
		<!--Connect Mobaile View-->

    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>

	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
	<script>

		function validateForm() {
		  const phoneInput = document.getElementById('phone');
		  const pincodeInput = document.getElementById('pincode');
		  const cityInput = document.getElementById('city');
		  const stateInput = document.getElementById('state');
	  
		  // Phone Number Validation
		  if (!/^\d{10}$/.test(phoneInput.value.trim())) {
			document.getElementById('phoneError').innerText = 'Please enter a valid 10-digit phone number';
			return false;
		  } else {
			document.getElementById('phoneError').innerText = '';
		  }
	  
		  // Pincode Validation
		  if (!/^\d{6}$/.test(pincodeInput.value.trim())) {
			document.getElementById('pincodeError').innerText = 'Please enter a valid 6-digit pincode';
			return false;
		  } else {
			document.getElementById('pincodeError').innerText = '';
		  }
	  
		  // City Validation
		  if (!/^[A-Za-z\s]+$/.test(cityInput.value.trim())) {
			document.getElementById('cityError').innerText = 'Please enter a valid city name';
			return false;
		  } else {
			document.getElementById('cityError').innerText = '';
		  }
	  
		  // State Validation
		  if (!/^[A-Za-z\s]+$/.test(stateInput.value.trim())) {
			document.getElementById('stateError').innerText = 'Please enter a valid state name';
			return false;
		  } else {
			document.getElementById('stateError').innerText = '';
		  }
	  
		  return true;
		}


		
	  </script>
<script>

function coupenCheck(val){

const msg = document.getElementById('g')
const btn = document.getElementById('btn')

fetch(`/coupenCehck` , {method : 'post' , headers : {'Content-Type' : 'application/json'} , body : JSON.stringify({inpVal : val.value})})

.then(res => res.json())

.then(data => {
	
	if(data.succ){
		
		msg.textContent = 'Valid Coupen'
		msg.classList.remove('text-danger')
		msg.classList.add('text-success')
		btn.disabled = false
		
	} else if(data.fail) {
		
		msg.textContent = 'Invalid Coupen'
		msg.classList.remove('text-success')
		msg.classList.add('text-danger')
		btn.disabled = true
		
	}
	
})

}

//	Remove Coupen :-

function remove(){
	
	fetch(`/removeCop` , {method : 'put'})
	
	.then(res => res.json())
	
	.then(data => {
		
		if(data.succ){
			
			window.location.reload()
			
		}
		
	})
	
}

const message = document.getElementById('msg')

if(message.textContent == 'coupen'){
	
	Swal.fire({
		position: "top-end",
		icon: "success",
		title: "Coupen Applied",
		showConfirmButton: false,
  timer: 1500
});

}
  
  //  Add Address Section :-

  function addAddress(id){

      const form = document.getElementById('addform');

      const formData = new FormData(form)
      const addressData = {}
      
      formData.forEach((value , key) => {

        addressData[key] = value;
        
      });

    fetch(`/verifyChekutAdss?id=${id} `, {method : 'post' , headers : {'Content-Type' : 'application/json'} , body:JSON.stringify({addressData})})

    .then(res => res.json()).then(data => {

      if(data.success){

        Swal.fire({
     
         title:'Address Added',
         text:'Address Added Successfully',
         icon:'success',
         confirmButtonText: 'OK'
     
        }).then((result) => {
 
         window.location.href = '/checkout'
         
        })

      } else {
    
        Swal.fire({
        
          title:'Failed',
          text:'Address Adding Failed',
          icon:'error',
          confirmButtonText: 'OK'
        
        }).then((result) => {
    
         window.location.href = '/checkout'
            
        })

      }

    })

}

//	Delete Address :-

function deleteAdd(id , addId){

	fetch(`deleteCheckAdd?id=${id}&&userid=${addId}` , {method : 'post'})

  .then(data =>{

   if(data.ok){

     Swal.fire({

		title: "Are you sure?",
		text: "You won't be able to delete this address!",
		icon: "warning",
		showCancelButton: true,
		confirmButtonColor: "#3085d6",
		cancelButtonColor: "#d33",
		confirmButtonText: "Yes, delete it!"

	}) .then((result) => {

			if (result.isConfirmed) {
			
				Swal.fire({
				
					title: "Deleted!",
					text: "Your Address has been deleted.",
					icon: "success"

				}).then((result) => {
    
         			window.location.href = '/checkout'
            
      			})

			}

	    })

    }

  })

};

//  Edit Address :-

function editAddress(edit){

	const namee = document.getElementById('n')
	const phonee = document.getElementById('p')
	const localityy = document.getElementById('loca')
	const pincodee = document.getElementById('pii')
	const addressss = document.getElementById('a')
	const cityy = document.getElementById('c')
	const statee = document.getElementById('s')
	const idd = document.getElementById('i');

  fetch('/editAddressCheckout' , {method : 'put'  , headers : {'Content-Type': 'application/json'} , body : JSON.stringify({edit})})

  .then((res) => res.json())

  .then((data) =>{

    const {name , phone , locality , pincode , address , city , state , _id} = data.editData.addresss[0];

    namee.value = name
    phonee.value = phone
    pincodee.value = pincode
    localityy.value = locality
    addressss.value = address
    cityy.value = city
    statee.value = state
    idd.value = _id

  })

};

//	Address Choose :-

function addresChoose(id){

	fetch(`/chooseAddress?id=${id}` , {method : 'post' , headers : {'Content-Type': 'application/json'}})

	window.location.href = '/checkout'

}

//	Sweet Alert For Edit Address :-

const msg = document.getElementById('msg');

if(msg.textContent == 'Address Edited'){

	 Swal.fire({
     
        title:'Address Edited',
        text:'Address Edited Successfully',
        icon:'success',
        confirmButtonText: 'OK'
     
    })

} else if(msg.textContent == 'Cart Empty'){


	Swal.fire({

		icon: "error",
		title: "Oops...",
		text: "Your Cart Is Empty!",
		footer: '<a href="/product">Why do I have this issue?</a>'

	});


} else if(msg.textContent == 'No Address'){


	Swal.fire({

		icon: "error",
		title: "Oops...",
		text: "Please Add Address!",
		footer: '<a href="/checkout">Why do I have this issue?</a>'

	});

} 

//	Payment Sumbit :-

function sumbitPayment(amount , userId){
	
	const form = document.getElementById('myForm'); 
    const Radio = document.querySelector('input[name="payment"]:checked');

	console.log(Radio.value);
    
    if(Radio.value == 'Online'){

        razorPay(amount, userId)
		
    }else{
		
        form.submit()

    }

}

//	RazorPay :-

function razorPay(amount , userId) {

const form = document.getElementById('myForm'); 

	fetch('/razorPay', {

		method: 'POST',
		headers: { 'Content-type': 'application/json' },

		body: JSON.stringify({ amount, userId })

	}).then(res => res.json()).then(data => {

		if (data.succes) {

			let options = {

				"key": `${data.key_id}`,
				"amount": `${data.amount}`,
				"currency": "INR",
				"name": "AUDIOFYX",
				"order_id": `${data.order_id}`,

				"handler": function (response) {

					form.submit();
									
				},

					"profile": {

					"name": `${data.name}`,
					"email": `${data.email}`
				}
			}

			let razorpayObject = new Razorpay(options);

			razorpayObject.on('payment.failed', (response) => {

				// Swal.fire({

				// 	icon: "error",
				// 	title: "Oops...",
				// 	text: "Your Payment Failed!",

				// });

			});

			razorpayObject.open();

		}
	})

}

</script>

<style>

 .style:hover{
      
   background-color:rgb(239, 239, 239) ;  

}

.style:active{

    background-color: rgb(211, 211, 211);

}

</style>
<%- include('../layouts/footer') %>